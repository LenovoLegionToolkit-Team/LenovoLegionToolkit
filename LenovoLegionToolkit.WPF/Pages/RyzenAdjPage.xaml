<wpfui:UiPage
    x:Class="LenovoLegionToolkit.WPF.Pages.RyzenAdjPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:LenovoLegionToolkit.WPF.Controls"
    xmlns:custom="clr-namespace:LenovoLegionToolkit.WPF.Controls.Custom"
    xmlns:utils="clr-namespace:LenovoLegionToolkit.WPF.Utils"
    xmlns:wpfui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="RyzenAdj"
    FlowDirection="{x:Static utils:LocalizationHelper.Direction}"
    Initialized="RyzenAdjPage_Initialized"
    Scrollable="True">

    <StackPanel Margin="0,0,16,12">
        <!-- Title -->
        <TextBlock
            Margin="0,16,0,8"
            Focusable="True"
            FontSize="24"
            FontWeight="Medium"
            Text="RyzenAdj - Advanced AMD Tuning" />

        <!-- CPU Info Section -->
        <StackPanel x:Name="_cpuInfoPanel" Margin="0,0,0,24" Orientation="Horizontal">
            <wpfui:SymbolIcon
                FontSize="64"
                Symbol="DeveloperBoard24" />
            <StackPanel
                Margin="16,0,0,0"
                VerticalAlignment="Center"
                Orientation="Vertical">
                <TextBlock
                    x:Name="_cpuNameText"
                    Margin="0,0,0,4"
                    Focusable="True"
                    FontSize="20"
                    FontWeight="Medium"
                    Text="Detecting CPU..." />
                <TextBlock
                    x:Name="_cpuCodenameText"
                    Focusable="True"
                    FontSize="14"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="" />
                <StackPanel x:Name="_driverStatusPanel" Margin="0,4,0,0" Orientation="Horizontal">
                    <wpfui:SymbolIcon
                        x:Name="_driverStatusIcon"
                        FontSize="16"
                        Foreground="{DynamicResource SystemFillColorSuccessBrush}"
                        Symbol="CheckmarkCircle24" />
                    <TextBlock
                        x:Name="_driverStatusText"
                        Margin="4,0,0,0"
                        FontSize="14"
                        Text="WinRing0 Driver: Checking..." />
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <!-- Not Supported Warning -->
        <wpfui:InfoBar
            x:Name="_notSupportedBar"
            Title="Not Supported"
            IsOpen="False"
            Margin="0,0,0,16"
            Message="RyzenAdj is only available on AMD Ryzen processors."
            Severity="Warning" />

        <!-- Driver Not Found Warning -->
        <wpfui:InfoBar
            x:Name="_driverNotFoundBar"
            Title="WinRing0 Driver Not Found"
            IsOpen="False"
            Margin="0,0,0,16"
            Message="The WinRing0 driver is required for RyzenAdj functionality. Please ensure WinRing0x64.dll and WinRing0x64.sys are in the application directory."
            Severity="Error" />

        <!-- Power Limits Section -->
        <TextBlock
            x:Name="_powerLimitsHeader"
            Margin="0,0,0,8"
            FontSize="16"
            FontWeight="Medium"
            Text="Power Limits" />

        <custom:CardControl x:Name="_stapmCard" Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="STAPM Limit (Sustained)" 
                    Subtitle="Sustained power limit for long workloads" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_stapmEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="StapmEnabled_Changed"
                    Unchecked="StapmEnabled_Changed" />
                <Slider
                    x:Name="_stapmSlider"
                    Width="200"
                    Minimum="5"
                    Maximum="100"
                    TickFrequency="5"
                    IsSnapToTickEnabled="True"
                    ValueChanged="StapmSlider_ValueChanged" />
                <TextBlock
                    x:Name="_stapmValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="-- W" />
            </StackPanel>
        </custom:CardControl>

        <custom:CardControl x:Name="_slowCard" Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="Slow PPT Limit" 
                    Subtitle="Slow power limit for medium workloads" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_slowEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="SlowEnabled_Changed"
                    Unchecked="SlowEnabled_Changed" />
                <Slider
                    x:Name="_slowSlider"
                    Width="200"
                    Minimum="5"
                    Maximum="120"
                    TickFrequency="5"
                    IsSnapToTickEnabled="True"
                    ValueChanged="SlowSlider_ValueChanged" />
                <TextBlock
                    x:Name="_slowValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="-- W" />
            </StackPanel>
        </custom:CardControl>

        <custom:CardControl x:Name="_fastCard" Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="Fast PPT Limit (Boost)" 
                    Subtitle="Maximum boost power limit for short bursts" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_fastEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="FastEnabled_Changed"
                    Unchecked="FastEnabled_Changed" />
                <Slider
                    x:Name="_fastSlider"
                    Width="200"
                    Minimum="5"
                    Maximum="150"
                    TickFrequency="5"
                    IsSnapToTickEnabled="True"
                    ValueChanged="FastSlider_ValueChanged" />
                <TextBlock
                    x:Name="_fastValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="-- W" />
            </StackPanel>
        </custom:CardControl>

        <custom:CardControl x:Name="_tempCard" Margin="0,0,0,24">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="CPU Temperature Limit" 
                    Subtitle="Maximum allowed CPU temperature (TCTL)" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_tempEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="TempEnabled_Changed"
                    Unchecked="TempEnabled_Changed" />
                <Slider
                    x:Name="_tempSlider"
                    Width="200"
                    Minimum="75"
                    Maximum="98"
                    TickFrequency="1"
                    IsSnapToTickEnabled="True"
                    ValueChanged="TempSlider_ValueChanged" />
                <TextBlock
                    x:Name="_tempValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="-- Â°C" />
            </StackPanel>
        </custom:CardControl>

        <!-- Turbo Boost Section -->
        <TextBlock
            x:Name="_turboBoostHeader"
            Margin="0,0,0,8"
            FontSize="16"
            FontWeight="Medium"
            Text="Turbo Boost" />

        <custom:CardControl x:Name="_turboBoostCard" Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="CPU Turbo Boost Mode" 
                    Subtitle="âš¡ ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ ÑÑ€Ð°Ð·Ñƒ | Control CPU boosting behavior" />
            </custom:CardControl.Header>
            <ComboBox
                x:Name="_turboBoostComboBox"
                MinWidth="200"
                VerticalAlignment="Center"
                SelectionChanged="TurboBoostComboBox_SelectionChanged">
                <ComboBoxItem Content="Disabled" Tag="Disabled" />
                <ComboBoxItem Content="Enabled (Standard)" Tag="Enabled" />
                <ComboBoxItem Content="Aggressive (Max Perf)" Tag="Aggressive" />
                <ComboBoxItem Content="Efficient Enabled" Tag="EfficientEnabled" />
                <ComboBoxItem Content="Efficient Aggressive" Tag="EfficientAggressive" />
                <ComboBoxItem Content="Aggressive at Guaranteed" Tag="AggressiveGuaranteed" />
                <ComboBoxItem Content="Efficient Aggressive at Guaranteed" Tag="EfficientAggressiveGuaranteed" />
            </ComboBox>
        </custom:CardControl>

        <custom:CardControl x:Name="_maxFreqCard" Margin="0,0,0,24">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="Max CPU Frequency" 
                    Subtitle="âš¡ ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ ÑÑ€Ð°Ð·Ñƒ | Limit maximum CPU clock speed" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_maxFreqEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="MaxFreqEnabled_Changed"
                    Unchecked="MaxFreqEnabled_Changed"
                    ToolTip="Enable frequency limit (unchecked = unlimited)" />
                <Slider
                    x:Name="_maxFreqSlider"
                    Width="200"
                    Minimum="1400"
                    Maximum="5400"
                    TickFrequency="100"
                    IsSnapToTickEnabled="True"
                    ValueChanged="MaxFreqSlider_ValueChanged" />
                <TextBlock
                    x:Name="_maxFreqValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="Unlimited" />
            </StackPanel>
        </custom:CardControl>

        <!-- Undervolting Section -->
        <TextBlock
            x:Name="_undervoltHeader"
            Margin="0,0,0,8"
            FontSize="16"
            FontWeight="Medium"
            Text="Undervolting (Curve Optimizer)" />

        <wpfui:InfoBar
            x:Name="_undervoltWarningBar"
            Title="Warning: System Stability Risk"
            IsClosable="False"
            IsOpen="True"
            Margin="0,0,0,8"
            Message="Aggressive undervolting may cause system instability, crashes, or BSODs. Start with small values (-5) and increase gradually. Not recommended for inexperienced users."
            Severity="Warning" />

        <custom:CardControl x:Name="_cpuUvCard" Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="CPU All-Core Curve Optimizer" 
                    Subtitle="Negative values reduce voltage (undervolting)" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_cpuUvEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="CpuUvEnabled_Changed"
                    Unchecked="CpuUvEnabled_Changed" />
                <Slider
                    x:Name="_cpuUvSlider"
                    Width="200"
                    Minimum="-40"
                    Maximum="0"
                    TickFrequency="1"
                    IsSnapToTickEnabled="True"
                    ValueChanged="CpuUvSlider_ValueChanged" />
                <TextBlock
                    x:Name="_cpuUvValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="0" />
            </StackPanel>
        </custom:CardControl>

        <custom:CardControl x:Name="_igpuUvCard" Margin="0,0,0,24">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="iGPU Curve Optimizer" 
                    Subtitle="Negative values reduce iGPU voltage" />
            </custom:CardControl.Header>
            <StackPanel Orientation="Horizontal">
                <CheckBox
                    x:Name="_igpuUvEnabled"
                    VerticalAlignment="Center"
                    Margin="0,0,8,0"
                    Checked="IgpuUvEnabled_Changed"
                    Unchecked="IgpuUvEnabled_Changed" />
                <Slider
                    x:Name="_igpuUvSlider"
                    Width="200"
                    Minimum="-30"
                    Maximum="0"
                    TickFrequency="1"
                    IsSnapToTickEnabled="True"
                    ValueChanged="IgpuUvSlider_ValueChanged" />
                <TextBlock
                    x:Name="_igpuUvValueText"
                    Margin="8,0,0,0"
                    VerticalAlignment="Center"
                    FontSize="14"
                    Text="0" />
            </StackPanel>
        </custom:CardControl>

        <!-- Options Section -->
        <TextBlock
            Margin="0,0,0,8"
            FontSize="16"
            FontWeight="Medium"
            Text="Options" />

        <custom:CardControl Margin="0,0,0,8">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="Auto-apply on Startup" 
                    Subtitle="Apply these settings when the application starts" />
            </custom:CardControl.Header>
            <wpfui:ToggleSwitch
                x:Name="_autoApplyStartupToggle"
                Checked="AutoApplyStartupToggle_Changed"
                Unchecked="AutoApplyStartupToggle_Changed" />
        </custom:CardControl>

        <custom:CardControl Margin="0,0,0,24">
            <custom:CardControl.Header>
                <controls:CardHeaderControl 
                    Title="Auto-apply on Power Mode Change" 
                    Subtitle="Re-apply settings when switching power modes" />
            </custom:CardControl.Header>
            <wpfui:ToggleSwitch
                x:Name="_autoApplyPowerModeToggle"
                Checked="AutoApplyPowerModeToggle_Changed"
                Unchecked="AutoApplyPowerModeToggle_Changed" />
        </custom:CardControl>

        <!-- Action Buttons -->
        <StackPanel 
            Margin="0,0,0,16" 
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <wpfui:Button
                x:Name="_presetsButton"
                Margin="0,0,8,0"
                Appearance="Secondary"
                Content="ðŸŽ¯ ÐŸÑ€ÐµÑÐµÑ‚Ñ‹"
                ToolTip="Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº"
                Click="PresetsButton_Click" />
            <wpfui:Button
                x:Name="_resetAllButton"
                Margin="0,0,8,0"
                Appearance="Caution"
                Content="â†©ï¸ Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²ÑÑ‘"
                ToolTip="Ð¡Ð±Ñ€Ð¾Ñ Ð²ÑÐµÑ… Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ðº Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÐ¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ"
                Click="ResetAllButton_Click" />
            <wpfui:Button
                x:Name="_applyButton"
                Appearance="Primary"
                Content="âœ“ ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"
                ToolTip="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ðº Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸ÑŽ"
                Click="ApplyButton_Click" />
        </StackPanel>

    </StackPanel>
</wpfui:UiPage>
